 ● Events System › Combat Events › should record combat actions with move type

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 0
    Received array:  []

      300 |       eventsSystem.onCombatAction(action, entityId);
      301 |
    > 302 |       expect(receivedEvents).toHaveLength(1);
          |                              ^
      303 |       expect(receivedEvents[0].type).toBe('movement');
      304 |       expect(receivedEvents[0].message).toBe('Crawler Test Crawler moved to a new position');
      305 |       expect(receivedEvents[0].priority).toBe('low');

      at Object.<anonymous> (shared/__tests__/events-system.test.ts:302:30)

  ● Events System › Combat Events › should record combat actions with attack type

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 0
    Received array:  []

      314 |       eventsSystem.onCombatAction(action, entityId, targetId, damage);
      315 |
    > 316 |       expect(receivedEvents).toHaveLength(1);
          |                              ^
      317 |       expect(receivedEvents[0].type).toBe('combat');
      318 |       expect(receivedEvents[0].message).toBe('Angry Goblin used Sword Strike on Test Crawler');
      319 |       expect(receivedEvents[0].priority).toBe('high');

      at Object.<anonymous> (shared/__tests__/events-system.test.ts:316:30)

  ● Events System › Combat Events › should record combat actions without target

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 0
    Received array:  []

      327 |       eventsSystem.onCombatAction(action, entityId);
      328 |
    > 329 |       expect(receivedEvents).toHaveLength(1);
          |                              ^
      330 |       expect(receivedEvents[0].type).toBe('combat');
      331 |       expect(receivedEvents[0].message).toBe('Crawler Test Crawler used Heal');
      332 |       expect(receivedEvents[0].priority).toBe('medium');

      at Object.<anonymous> (shared/__tests__/events-system.test.ts:329:30)

Test Suites: 1 failed, 1 total
Tests:       6 failed, 17 passed, 23 total
Snapshots:   0 total
Time:        14.501 s
Ran all test suites matching /shared\/__tests__\/events-system.test.ts/i.
Jest did not exit one second after the test run has completed.

'This usually means that there are asynchronous operations that weren't stopped in your tests. Consider running Jest with `--detectOpenHandles` to troubleshoot this issue.

ReferenceError: You are trying to `import` a file after the Jest environment has been torn down. From shared/__tests__/events-system.test.ts.

      103 |       entityName: crawlerName,
      104 |       direction: (storedDirection && ["north", "south", "east", "west"].includes(storedDirection)) 
    > 105 |         ? storedDirection as "north" | "south" | "east" | "west" 
          |                                                   ^
      106 |         : undefined,
      107 |       priority: "medium",
      108 |     });

      at shared/events-system.ts:105:51